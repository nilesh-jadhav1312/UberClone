# POST /users/register

Description

- Register a new user. This endpoint is mounted at `/users/register` (assumes the users router is mounted at `/users`).
- Accepts JSON and returns a JWT token plus the created user.

Request

- Method: POST
- URL: `/users/register`
- Headers: `Content-Type: application/json`

Required JSON body

```
{
  "fullname": {
    "firstname": "John",
    "lastname": "Doe"
  },
  "email": "john@example.com",
  "password": "password123"
}
```

Validation rules

- `fullname.firstname`: string, required, minimum length 3
- `fullname.lastname`: string, required, minimum length 3
- `email`: required, must be a valid email
- `password`: required, minimum length 6

Responses / Status codes

- 201 Created
  - Description: User successfully created.
  - Body: JSON containing `token` (JWT) and `user` object (password is not returned).  sending as a response with JWT token and user details
  - Example:

```
HTTP/1.1 201 Created
{
  "token": "<jwt_token>",
  "user": {
    "_id": "64...",
    "fullname": { "firstname": "John", "lastname": "Doe" },
    "email": "john@example.com",
    "socketId": null
  }
}
```

- 400 Bad Request
  - Description: Validation failed (missing/invalid fields).
  - Body: `{ "errors": [ ... ] }` where each item includes validation details.
  - Example:

```
HTTP/1.1 400 Bad Request
{
  "errors": [
    { "msg": "Invalid Mail id", "param": "email", "location": "body" }
  ]
}
```

- 500 Internal Server Error
  - Description: Unexpected server/database error (e.g., duplicate email or DB failure).

Notes

- Passwords are hashed before being saved; the API does not return the plain password.
- The controller returns a JWT via `token` generated by `user.generateAuthToken()`.
- Ensure `process.env.JWT_SECRET` is set in your environment for token generation.

---

# POST /users/login

Description

- Authenticate an existing user and return a JWT plus the user object.
- The login route is mounted at `/users/login` (assumes the users router is mounted at `/users`).

Request

- Method: POST
- URL: `/users/login`
- Headers: `Content-Type: application/json`

Required JSON body

```
{
  "email": "john@example.com",
  "password": "password123"
}
```

What data is handled and how

- The endpoint reads `email` and `password` from the request body.
- The server looks up the user by `email` using `userModel.findOne({ email }).select('+password')` so the hashed password field is available for comparison.
- The submitted `password` is compared to the stored hashed password using `user.comparePassword(password)` (bcrypt compare).
- On successful authentication a JWT is generated with `user.generateAuthToken()` (the token payload contains the user `_id` and is signed with `process.env.JWT_SECRET`).
- The plaintext password is never returned in responses and passwords are stored hashed.

Token details and usage

- The returned `token` is a JWT used for authenticating subsequent requests.
- Clients should store it securely (e.g., HttpOnly cookie or secure storage) and include it in requests using the `Authorization: Bearer <token>` header.

Responses / Status codes

- 200 OK
  - Description: Authentication successful.
  - Body: JSON containing `token` (JWT) and `user` object (password excluded).
  - Example:
```
HTTP/1.1 200 OK
{
  "token": "<jwt_token>",
  "user": {
    "_id": "64...",
    "fullname": { "firstname": "John", "lastname": "Doe" },
    "email": "john@example.com",
    "socketId": null
  }
}
```

- 400 Bad Request
  - Description: Validation errors (missing or invalid fields).
  - Body: `{ "errors": [ ... ] }`.

- 401 Unauthorized
  - Description: Invalid credentials (email not found or password mismatch).
  - Example:
```
HTTP/1.1 401 Unauthorized
{
  "message": "Invalid email "
}
```

- 500 Internal Server Error
  - Description: Unexpected server/database error.

Notes

- The controller uses `validationResult` (from `express-validator`) to return validation failures as `400` with `{ errors: [...] }`.
- Ensure `process.env.JWT_SECRET` is set so tokens can be signed and verified.
